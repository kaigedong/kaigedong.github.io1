<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.1.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.1.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.1.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.1.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="from MACS manual ：Identifying ChIP-seq enrichment using MACS 步骤：版本1.4  安装macs 安装可选软件">
<meta name="keywords" content="macs ChIP-seq">
<meta property="og:type" content="article">
<meta property="og:title" content="ChIP-seq-macs">
<meta property="og:url" content="http://yoursite.com/2017/09/22/ChIP-seq-masc/index.html">
<meta property="og:site_name" content="读书笔记">
<meta property="og:description" content="from MACS manual ：Identifying ChIP-seq enrichment using MACS 步骤：版本1.4  安装macs 安装可选软件">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-04-14T04:34:53.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ChIP-seq-macs">
<meta name="twitter:description" content="from MACS manual ：Identifying ChIP-seq enrichment using MACS 步骤：版本1.4  安装macs 安装可选软件">






  <link rel="canonical" href="http://yoursite.com/2017/09/22/ChIP-seq-masc/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>ChIP-seq-macs | 读书笔记</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">读书笔记</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>




<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />Tags</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />Archives</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-schedule">
    <a href="/schedule/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br />Schedule</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/22/ChIP-seq-masc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Kaige Dong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="读书笔记">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">ChIP-seq-macs
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
                
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-22T18:14:20+08:00">2017-09-22</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>from MACS manual ：<strong><em>Identifying ChIP-seq enrichment using MACS</em></strong></p>
<p>步骤：<code>版本1.4</code></p>
<ol>
<li>安装macs</li>
<li>安装可选软件</li>
</ol>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bowtie; samtools;R;PeakSplitter;igv;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">下载bowtie index;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>运行MACS to call peaks</li>
</ol>
<ul>
<li><strong>以下用不同的数据来阐述如何使用不同的参数来运行macs。</strong></li>
</ul>
<p>用<strong>A来call FoxA1 peaks</strong>; 用<strong>B来 call H3K4me3 peaks 并打开片段大小评估</strong>；用<strong>C来call H3K4me3 peaks 用一个固定的片段大小</strong>；用<strong>D来call H3K4me4 peaks</strong></p>
<hr>
<h2 id="A-Call-FoxA1-peaks"><a href="#A-Call-FoxA1-peaks" class="headerlink" title="A: Call FoxA1 peaks"></a>A: Call FoxA1 peaks</h2><ul>
<li>解压hg19 index 文件：<code>unzip hg19.ebwt.zip</code></li>
<li>下载FoxA1 raw reads from <a href="http://cistrome.dfci.harvard.edu/MACSNatureProtocol/HAIB_T47D_FoxA1.tar.gz" target="_blank" rel="noopener">http://cistrome.dfci.harvard.edu/MACSNatureProtocol/HAIB_T47D_FoxA1.tar.gz</a> 解压并将raw reads map到参考基因组上，使用bowtie：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar xzvf HAIB_T47D_FoxA1.tar.gz</span><br><span class="line">bowtie -m 1 -S -q /path_to/hg19 HAIB_T47D_FoxA1.fastq HAIB_T47D_FoxA1.sam</span><br></pre></td></tr></table></figure>
<p><strong>参数说明</strong></p>
<blockquote>
<p><strong><code>-m 1</code></strong> #specifies that reads with only one hit on the genome are retained;</p>
<p><strong><code>-S</code></strong> #specifies the output format as SAM;</p>
<p><strong><code>-q</code></strong> #specifies the input format as FASTQTQ;</p>
<p><strong><code>/path_to/</code></strong> #is the directory containing the unzipped bowtie prebuilt indexes; and </p>
<p><strong><code>HAIB_T47D_FoxA1.fastq</code></strong> #contains the downloaded raw reads for FoxA1.</p>
</blockquote>
<ul>
<li>运行macs</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macs -t HAIB_T47D_FoxA1.sam -n HAIB_T47D_FoxA1 -g hs -B -S --call-subpeaks</span><br></pre></td></tr></table></figure>
<p><strong>MACS版本</strong></p>
<blockquote>
<p>直接使用<code>macs</code>调用的是<code>1.4.2</code><br>要使用macs 2 可使用命令：<code>macs2</code></p>
</blockquote>
<h3 id="输出文件说明"><a href="#输出文件说明" class="headerlink" title="输出文件说明"></a>输出文件说明</h3><table>
<thead>
<tr>
<th>File name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>HAIB_T47D_FoxA1_model.r</td>
<td>一个R脚本可用来生成峰的PDF</td>
</tr>
<tr>
<td>HAIB_T47D_FoxA1_model.pdf</td>
<td>执行R脚本后生成，PDF文件描述了read在峰上的分布和片段大小评估</td>
</tr>
<tr>
<td>HAIB_T47D_FoxA1_peaks.xls</td>
<td>MACS使用的主要参数和鉴定出来的峰的细节信息</td>
</tr>
<tr>
<td>HAIB_T47D_FoxA1_peaks.bed</td>
<td>峰的坐标BED格式</td>
</tr>
<tr>
<td>HAIB_T47D_FoxA1_peaks.subpeaks.bed</td>
<td>Subpeak locations in BED-like format.由PeakSplitter 生成, 被MACS调用。</td>
</tr>
<tr>
<td>HAIB_T47D_FoxA1_summits.bed</td>
<td>Summit locations of the peaks in BED format</td>
</tr>
<tr>
<td>HAIB_T47D_FoxA1_MACS_bedGraph</td>
<td>Directory where the BedGraph files are generated. For each control or ChIP-seq sample, a BedGraph file describes the read distribution along the whole genome</td>
</tr>
</tbody>
</table>
<p><strong>参数说明</strong></p>
<blockquote>
<p><strong><code>-t</code></strong>  指定ChIP-seq read比对结果的文件名。MACS支持并能自动识别： SAM, BAM, BED, ELAND, ELANDMULTI, ELANDMULTIPET, ELANDEXPORT and BOWTIE. 使用参数<code>--format</code> 可以覆盖自动识别的格式。</p>
<p><strong><code>-g</code></strong> 指定基因组大小。<code>hs</code> 参数是人基因组大小的近似的缩写。等于2.7e9.</p>
<p><strong><code>-n</code></strong> 应用<code>‘HAIB_T47D_FoxA1’</code>作为输出文件的前缀。</p>
<p><strong><code>-B</code></strong>  生成bedGraph格式的文件包含拓展的每个碱基对的read 堆积的信号文件。这个步骤很耗费内存和时间。因此，只有在需要bedGraph文件时，才指定-B.</p>
<p><strong><code>-S</code></strong>对于真个基因组生成单一的bedGraph 文件。否则的话，会对每个染色体生成一个。 </p>
</blockquote>
<p><strong>其他可能会遇到的参数</strong></p>
<blockquote>
<p><strong><code>--bw</code></strong> sets the ‘bandwidth’, which is half of the sliding window size used in the model-building step.</p>
<p><strong><code>--mfold</code></strong> specifies an interval of high-confidence enrichment ratio against the background on which to build the model. The default value ‘10, 30’ means that a model will be built on the basis of regions having read counts that are 10- to 30-fold of the background.</p>
<p><strong><code>--pvalue</code></strong> establishes a threshold P value: only peaks surpassing the threshold will be reported. The default threshold is 10 − 5.Users can first set a loose P value cutoff so that a sufficient number of peaks will be reported and then select peaks having the smallest P values for downstream analyses.</p>
</blockquote>
<ul>
<li>检查MACS在终端的输出状态：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">INFO @ Sun, 03 Jun 2012 23:36:03:</span><br><span class="line"># ARGUMENTS LIST:</span><br><span class="line"># name  =   HAIB_T47D_FoxA1</span><br><span class="line"># format  =   AUTO</span><br><span class="line"># ChIP-seq file  =   HAIB_T47D_FoxA1.sam</span><br><span class="line"># control file  =   None</span><br><span class="line"># effective genome size  =   2.70e + 09</span><br><span class="line"># band width  =   300</span><br><span class="line"># model fold  =   10,30</span><br><span class="line"># pvalue cutoff  =   1.00e-05</span><br><span class="line"># Large dataset will be scaled towards smaller dataset.</span><br><span class="line"># Range for calculating regional lambda is: 10000 bps</span><br><span class="line">INFO #1 read tag files.</span><br><span class="line">INFO #1 read treatment tags.</span><br><span class="line">INFO Detected format is: SAM</span><br><span class="line"> &lt; Several lines are skipped &gt; </span><br><span class="line">INFO #2 Build Peak Model.</span><br><span class="line">INFO #2 number of paired peaks: 16586</span><br><span class="line">INFO #2 finished!</span><br><span class="line">INFO #2 predicted fragment length is 114 bps</span><br><span class="line">INFO #2.2 Generate R script for model : HAIB_T47D_FoxA1_model.r</span><br><span class="line">INFO #3 Call peaks.</span><br><span class="line">INFO #3 shift treatment data</span><br><span class="line">INFO #3 merge  + /- strand of treatment data</span><br><span class="line">INFO #3 save the shifted and merged tag counts into bedGraph file.</span><br><span class="line">INFO write to a bedGraph file</span><br><span class="line"> &lt; Several lines are skipped &gt; </span><br><span class="line">INFO #3 call peak candidates</span><br><span class="line">INFO #3 use self to calculate local lambda and filter peak candidates.</span><br><span class="line">INFO #3 Finally, 74761 peaks are called!</span><br><span class="line">INFO #4 Write output xls file. HAIB_T47D_FoxA1_peaks.xls</span><br><span class="line">INFO #4 Write peak bed file. HAIB_T47D_FoxA1_peaks.bed</span><br><span class="line">INFO #4 Write summits bed file. HAIB_T47D_FoxA1_summits.bed</span><br><span class="line">INFO #5 Done! Check the output files!</span><br><span class="line">INFO #6 Try to invoke PeakSplitter.</span><br><span class="line">INFO #6 Please check HAIB_T47D_FoxA1_peaks.subpeaks.bed file for PeakSplitter </span><br><span class="line">output!</span><br></pre></td></tr></table></figure>
<blockquote>
<p>输出的信息如下：<strong>日期（第一行）；主要参数（以<code>#</code>开头的行）；运行过程（以<code>INFO</code>开头的行）。</strong>运行过程中的时间信息已经被移除了（为了更直观）。如果MACS遇到了异常（比如MACS评估一个片段大小太小），警告信息将会出现。</p>
</blockquote>
<blockquote>
<p>! 注意 尽管警告信息不影响MACS运行，仍需要认真对待警告。例如，</p>
<p>警告信息：<strong><code>unbalanced reads between treatment and control</code></strong>means that the FDR of the resulting peaks will be overestimated when the control sample has more reads and will be underestimated when the ChIP-seq sample is sequenced more deeply. </p>
<p>警告信息：<strong><code>Fewer paired peaks X than 1,000</code></strong> means that MACS only identified X model peaks and may indicate potential data quality issues because 1,000 model peaks are needed to robustly estimate ChIP-DNA fragment size. </p>
<p>警告信息<strong><code>missing chromosome X data</code></strong>might suggest that <strong>the raw input file for that chromosome is incomplete</strong>.</p>
</blockquote>
<ul>
<li>生成peak模型的PDF图像（假设R已经被安装）</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rscript HAIB_T47D_FoxA1_model.r</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在当前目录生成名为<code>HAIB_T47D_FoxA1_model.pdf</code>的文件，图像描述了reads在峰的模型中正义链反义链上的分布和评估的片段的大小。</p>
</blockquote>
<hr>
<h2 id="B-call-H3K4me3-peaks"><a href="#B-call-H3K4me3-peaks" class="headerlink" title="B: call H3K4me3 peaks"></a>B: call H3K4me3 peaks</h2><ul>
<li><strong>数据的获取</strong>：数据包含一个<code>control replicate</code> 和一个 <code>ChIP-seq replicate</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nohup wget -c  http://cistrome.dfci.harvard.edu/MACSNatureProtocol/UW_K562_H3K4me3.tar.gz &amp;</span><br><span class="line">tar xvzf UW_K562_H3K4me3.tar.gz</span><br></pre></td></tr></table></figure>
<p><strong>运行MACS:</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macs -t UW_K562_H3K4me3.bam -c UW_K562_H3K4me3_Control.bam -g hs -n UW_K562_H3K4me3 -B -S --call-subpeaks</span><br></pre></td></tr></table></figure>
<blockquote>
<p>参数<code>-c</code>指明了control 样本的文件名。</p>
</blockquote>
<ul>
<li><p>**检查MACS的屏幕输出，如果运行成功，MACS会输出如下信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> &lt; Several lines are skipped &gt; </span><br><span class="line">INFO : #2 Build Peak Model.</span><br><span class="line">INFO : #2 number of paired peaks: 12267</span><br><span class="line">INFO : #2 finished!</span><br><span class="line">INFO : #2 predicted fragment length is 156 bps</span><br><span class="line"> &lt; Several lines are skipped &gt; </span><br><span class="line">INFO : #3 use control data to filter peak candidates.</span><br><span class="line">INFO : #3 Finally, 20632 peaks are called!</span><br><span class="line">INFO : #3 find negative peaks by swapping treat and control</span><br><span class="line">INFO : #3 Finally, 4006 peaks are called!</span><br><span class="line"> &lt; Several lines are skipped &gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>生成PDF图像:</strong></p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rscript UW_K562_H3K4me3_model.r</span><br></pre></td></tr></table></figure>
<blockquote>
<p>对于输出文件：因为这一步比上一个多用了一个control sample，会生成额外的文件<code>UW_K562_H3K4me3_negative_peaks.xls</code>包含了peaks called by comparing the control sample with the ChIP-seq sample. 这些peaks 被MACS用来评估报告的ChIP-seq峰的FDR。</p>
</blockquote>
<hr>
<h2 id="C-call-H3K4me3-peaks-with-a-specified-DNA-fragment-size"><a href="#C-call-H3K4me3-peaks-with-a-specified-DNA-fragment-size" class="headerlink" title="C: call H3K4me3 peaks with a specified DNA fragment size"></a>C: call H3K4me3 peaks with a specified DNA fragment size</h2><ul>
<li><strong>下载数据</strong>：包含一个ChIP-Seq replicate 和两个control replicates。<strong>两个control要被合并</strong>。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nohup wget -c  http://cistrome.dfci.harvard.edu/MACSNatureProtocol/BROAD_GM12878_H3K4me3.tar.gz 1&gt;download.log 2&gt;&amp;1&amp;</span><br><span class="line">tar xvzf BROAD_GM12878_H3K4me3.tar.gz</span><br><span class="line">samtools merge BROAD_GM12878_H3K4me3_Control.bam BROAD_GM12878_H3K4me3_Control_1.bam BROAD_GM12878_H3K4me3_Control_2.bam</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>运行MACS：</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macs -t BROAD_GM12878_H3K4me3.bam -c BROAD_GM12878_H3K4me3_Control.bam -g hs -n BROAD_GM12878_H3K4me3 -B -S --call-subpeaks</span><br></pre></td></tr></table></figure>
<ul>
<li>检查屏幕输出，应该包含下列行：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> &lt; Several lines are skipped &gt; </span><br><span class="line">INFO : #2 number of paired peaks: 31077</span><br><span class="line">INFO : #2 finished!</span><br><span class="line">INFO : #2 predicted fragment length is 53 bps</span><br><span class="line"> &lt; Several lines are skipped &gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>MACS 建立的模型片段长度为53，是不同寻常的短在典型的ChIP-Seq 实验中。因此，修改参数重新运行MACS：</p>
</blockquote>
<ul>
<li>可使用Ctrl + C 终止MACS的运行。然后移除文件夹：<code>BROAD_GM12878_H3K4me3_MACS_bedGraph</code></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf BROAD_GM12878_H3K4me3_MACS_bedGraph</span><br></pre></td></tr></table></figure>
<ul>
<li>重新运行MACS：</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macs14 -t BROAD_GM12878_H3K4me3.bam -c BROAD_GM12878_H3K4me3_Control.bam -g hs -n BROAD_GM12878_H3K4me3 --nomodel --shiftsize 73 -B -S --call-subpeak</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="D-Calling-H3K36me3-peaks"><a href="#D-Calling-H3K36me3-peaks" class="headerlink" title="D:Calling H3K36me3 peaks"></a>D:Calling H3K36me3 peaks</h2><ul>
<li><strong>下载数据</strong>:该数据包含两个control replicates 和两个ChIP-seq replicates</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://cistrome.dfci.harvard.edu/MACSNatureProtocol/BROAD_GM12878_H3K36me3.tar.gz</span><br><span class="line">tar xvzf BROAD_GM12878_H3K36me3.tar.gz</span><br><span class="line">samtools merge BROAD_GM12878_H3K36me3.bam BROAD_GM12878_H3K36me3_1.bam BROAD_GM12878_H3K36me3_2.bam</span><br><span class="line">samtools merge BROAD_GM12878_H3K36me3_Control.bam BROAD_GM12878_H3K36me3_Control_1.bam BROAD_GM12878_H3K36me3_Control_2.bam</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Run MACS:</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macs -t BROAD_GM12878_H3K36me3.bam -c BROAD_GM12878_H3K36me3_Control.bam -g hs -n BROAD_GM12878_H3K36me3 --nomodel --shiftsize 73 -B -S --pvalue 1e-3 --call-subpeaks</span><br></pre></td></tr></table></figure>
<blockquote>
<p>与默认<code>--pvalue 1e-5</code>相比，这一步使用的p-value<code>--pvalue 1e-3</code>不太严格。因为H3K36me3 ChIP-seq 数据经常来自有更宽的不太集中的区域，参数<code>--nomodel</code> 和 <code>--shiftsize 73</code>优先采用。</p>
</blockquote>
<hr>
<h1 id="使用IGV加载MACS的结果"><a href="#使用IGV加载MACS的结果" class="headerlink" title="使用IGV加载MACS的结果"></a>使用IGV加载MACS的结果</h1><ol>
<li>首先解压并重命名 <code>bedGraph</code> 文件。以FoxA1数据集为例，首先定位到<code>HAIB_T47D_FoxA1_MACS_bedGraph/treat</code>,</li>
<li>解压文件 <code>gzip -d HAIB_T47D_FoxA1_treat_afterfiting_all.bdg.gz</code></li>
<li>更改后缀为<code>bedGraph</code>，这样可被IGV识别<code>mv HAIB_T47D_FoxA1_treat_afterfiting_all.bdg HAIB_T47D_FoxA1_treat_afterfiting_all.bedGraph</code></li>
<li>用IGV加载<code>HAIB_T47D_FoxA1_treat_afterfiting_all.bedGraph</code>，根据IGV的手册。</li>
</ol>
<hr>
<h2 id="macs2的用法-部分"><a href="#macs2的用法-部分" class="headerlink" title="macs2的用法(部分)"></a>macs2的用法(部分)</h2><p><a href="https://pypi.python.org/pypi/MACS2" target="_blank" rel="noopener">https://pypi.python.org/pypi/MACS2</a></p>
<h3 id="Usage-of-MACS2"><a href="#Usage-of-MACS2" class="headerlink" title="Usage of MACS2"></a>Usage of MACS2</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">macs2 [-h] [--version]</span><br><span class="line">&#123;callpeak,filterdup,bdgpeakcall,bdgcmp,randsample,bdgdiff,bdgbroadcall&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Example-for-regular-peak-calling"><a href="#Example-for-regular-peak-calling" class="headerlink" title="Example for regular peak calling"></a>Example for regular peak calling</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macs2 callpeak -t ChIP.bam -c Control.bam -f BAM -g hs -n test -B -q 0.01</span><br></pre></td></tr></table></figure>
<h3 id="Example-for-broad-peak-calling"><a href="#Example-for-broad-peak-calling" class="headerlink" title="Example for broad peak calling"></a>Example for broad peak calling</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">macs2 callpeak -t ChIP.bam -c Control.bam --broad -g hs --broad-cutoff 0.1</span><br></pre></td></tr></table></figure>
<h3 id="几个常用的sub-commands"><a href="#几个常用的sub-commands" class="headerlink" title="几个常用的sub-commands"></a>几个常用的<strong>sub-commands</strong></h3><p><strong>callpeak</strong>:    Main MACS2 Function to Call peaks from alignment results.<br><strong>bdgpeakcall</strong>:    Call peaks from bedGraph output.<br><strong>bdgbroadcall</strong>:    Call broad peaks from bedGraph output.<br><strong>bdgcmp</strong>:    Deduct noise by comparing two signal tracks in bedGraph.<br><strong>bdgdiff</strong>:    Differential peak detection based on paired four bedgraph files.<br><strong>filterdup</strong>eads at the same position, then convert acceptable format to BED format.<br><strong>predictd</strong>:    Predict d or fragment size from alignment results.<br><strong>pileup</strong>:    Pileup aligned reads with a given extension size (fragment size or d in MACS language). Note there will be no step for duplicate reads filtering or sequencing depth scaling, so you may need to do certain post- processing.<br><strong>randsample</strong>:    Randomly sample number/percentage of total reads.<br><strong>refinepeak</strong>:    (Experimental) Take raw reads alignment, refine peak summits and give scores measuring balance of forward- backward tags. Inspired by SPP.</p>
<p><strong>下面只讲<code>callpeak</code>模块</strong>，其他内容可以<code>macs2 COMMAND -h</code>来查看细节</p>
<ul>
<li><p><strong>Call peaks</strong></p>
<p>是macs2的主要功能，可以用<code>macs2 callpeak</code>命令直接调用。如果不加参数直接输这个命令，你将会看到这个参数的详细描述。</p>
</li>
<li><p><strong>Options</strong></p>
<ul>
<li><code>-t/–treatment FILENAME</code>:这是唯一必须的参数，如果你有多个alignment files，你可以这样指明它们<code>-t A B C</code>,macs 将会pool up all these files</li>
<li><code>-c/–control</code>：与<code>-t</code>参数相同</li>
<li><code>-n/–name</code>:实验的名字，MACS将会使用这个名字来生成输出文件如<code>NAME_peaks.xls</code></li>
<li><code>–outdir</code>:MACS将通过这个参数将文件输出到指定的文件夹</li>
<li><code>-f/–format FORMAT</code>:Format of tag file, can be “ELAND”, “BED”, “ELANDMULTI”, “ELANDEXPORT”, “ELANDMULTIPET” (for pair-end tags), “SAM”, “BAM”, “BOWTIE”, “BAMPE” or “BEDPE”. Default is “AUTO” which will allow MACS to decide the format automatically. “AUTO” is also usefule when you combine different formats of files. Note that MACS can’t detect “BAMPE” or “BEDPE” format with “AUTO”, and you have to implicitly specify the format for “BAMPE” and “BEDPE”.</li>
</ul>
</li>
</ul>

      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/macs-ChIP-seq/" rel="tag"># macs ChIP-seq</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/09/22/Affymetrix芯片原理/" rel="prev" title="Affymetrix芯片原理">
                Affymetrix芯片原理 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Kaige Dong</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">35</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">3</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#A-Call-FoxA1-peaks"><span class="nav-number">1.</span> <span class="nav-text">A: Call FoxA1 peaks</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#输出文件说明"><span class="nav-number">1.1.</span> <span class="nav-text">输出文件说明</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#B-call-H3K4me3-peaks"><span class="nav-number">2.</span> <span class="nav-text">B: call H3K4me3 peaks</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C-call-H3K4me3-peaks-with-a-specified-DNA-fragment-size"><span class="nav-number">3.</span> <span class="nav-text">C: call H3K4me3 peaks with a specified DNA fragment size</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#D-Calling-H3K36me3-peaks"><span class="nav-number">4.</span> <span class="nav-text">D:Calling H3K36me3 peaks</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用IGV加载MACS的结果"><span class="nav-number"></span> <span class="nav-text">使用IGV加载MACS的结果</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#macs2的用法-部分"><span class="nav-number">1.</span> <span class="nav-text">macs2的用法(部分)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Usage-of-MACS2"><span class="nav-number">1.1.</span> <span class="nav-text">Usage of MACS2</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Example-for-regular-peak-calling"><span class="nav-number">1.1.1.</span> <span class="nav-text">Example for regular peak calling</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Example-for-broad-peak-calling"><span class="nav-number">1.2.</span> <span class="nav-text">Example for broad peak calling</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#几个常用的sub-commands"><span class="nav-number">1.3.</span> <span class="nav-text">几个常用的sub-commands</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kaige Dong</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Gemini</a> v6.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.1.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.1.0"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

</body>
</html>
